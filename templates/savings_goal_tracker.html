{% extends "budgeting_base.html" %}

{% block budgeting_title %}Savings Goal Tracker - E-Bank{% endblock %}
{% block tool_icon %}<i class="fas fa-target"></i>{% endblock %}
{% block tool_title %}Savings Goal Tracker{% endblock %}
{% block tool_description %}Set and monitor your financial goals with progress tracking{% endblock %}

{% block budgeting_content %}

    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h3>Create New Savings Goal</h3>
                </div>
                <div class="card-body">
                    <form id="savingsGoalForm">
                        <div class="form-group">
                            <label for="goalName">Goal Name</label>
                            <input type="text" class="form-control" id="goalName" placeholder="e.g., Emergency Fund, Vacation, New Car">
                        </div>
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label for="targetAmount">Target Amount (₹)</label>
                                <input type="number" class="form-control" id="targetAmount" placeholder="5000" min="1" step="0.01">
                            </div>
                            <div class="form-group col-md-6">
                                <label for="targetDate">Target Date</label>
                                <input type="date" class="form-control" id="targetDate">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="initialAmount">Initial Amount (₹)</label>
                            <input type="number" class="form-control" id="initialAmount" placeholder="0" min="0" step="0.01">
                        </div>
                        <div class="form-group">
                            <label for="goalCategory">Category</label>
                            <select class="form-control" id="goalCategory">
                                <option value="emergency">Emergency Fund</option>
                                <option value="vacation">Vacation</option>
                                <option value="home">Home Purchase</option>
                                <option value="car">Vehicle</option>
                                <option value="education">Education</option>
                                <option value="retirement">Retirement</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary">Create Goal</button>
                    </form>
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-header">
                    <h3>Current Goals</h3>
                </div>
                <div class="card-body">
                    <div id="goalsList">
                        <!-- Goals will be populated here -->
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h3>Savings Summary</h3>
                </div>
                <div class="card-body">
                    <div class="stat-item">
                        <h4>Total Goals</h4>
                        <p class="stat-value" id="totalGoals">0</p>
                    </div>
                    <div class="stat-item">
                        <h4>Total Target</h4>
                        <p class="stat-value" id="totalTarget">₹0</p>
                    </div>
                    <div class="stat-item">
                        <h4>Total Saved</h4>
                        <p class="stat-value" id="totalSaved">₹0</p>
                    </div>
                    <div class="stat-item">
                        <h4>Overall Progress</h4>
                        <div class="progress">
                            <div class="progress-bar bg-success" id="overallProgress" role="progressbar" style="width: 0%">0%</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-header">
                    <h3>Quick Actions</h3>
                </div>
                <div class="card-body">
                    <button class="btn btn-outline-primary btn-block mb-2" onclick="addToSavings()">
                        <i class="fas fa-plus"></i> Add to Savings
                    </button>
                    <button class="btn btn-outline-success btn-block mb-2" onclick="viewProgress()">
                        <i class="fas fa-chart-line"></i> View Progress
                    </button>
                    <button class="btn btn-outline-info btn-block" onclick="exportGoals()">
                        <i class="fas fa-download"></i> Export Goals
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.stat-item {
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid #eee;
}

.stat-item:last-child {
    border-bottom: none;
    margin-bottom: 0;
}

.stat-value {
    font-size: 24px;
    font-weight: bold;
    color: #28a745;
    margin: 0;
}

.goal-card {
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 15px;
    background: #f8f9fa;
}

.goal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.goal-title {
    font-size: 18px;
    font-weight: bold;
    margin: 0;
}

.goal-category {
    background: #007bff;
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
}

.goal-progress {
    margin-bottom: 10px;
}

.goal-stats {
    display: flex;
    justify-content: space-between;
    font-size: 14px;
    color: #666;
}

.navigation-buttons {
    margin-top: 30px;
    display: flex;
    justify-content: space-between;
}
</style>

<script>
// Sample data for demonstration
let savingsGoals = [
    {
        id: 1,
        name: "Emergency Fund",
        targetAmount: 10000,
        currentAmount: 6500,
        targetDate: "2024-12-31",
        category: "emergency"
    },
    {
        id: 2,
        name: "Summer Vacation",
        targetAmount: 3000,
        currentAmount: 1200,
        targetDate: "2024-07-01",
        category: "vacation"
    }
];

function loadGoals() {
    const goalsList = document.getElementById('goalsList');
    const totalGoals = document.getElementById('totalGoals');
    const totalTarget = document.getElementById('totalTarget');
    const totalSaved = document.getElementById('totalSaved');
    const overallProgress = document.getElementById('overallProgress');

    if (savingsGoals.length === 0) {
        goalsList.innerHTML = '<p class="text-muted">No savings goals yet. Create your first goal above!</p>';
        return;
    }

    let totalTargetAmount = 0;
    let totalSavedAmount = 0;

    goalsList.innerHTML = savingsGoals.map(goal => {
        const progress = (goal.currentAmount / goal.targetAmount) * 100;
        totalTargetAmount += goal.targetAmount;
        totalSavedAmount += goal.currentAmount;

        return `
            <div class="goal-card">
                <div class="goal-header">
                    <h4 class="goal-title">${goal.name}</h4>
                    <span class="goal-category">${goal.category}</span>
                </div>
                <div class="goal-progress">
                    <div class="progress">
                        <div class="progress-bar ${progress >= 100 ? 'bg-success' : 'bg-primary'}" 
                             role="progressbar" style="width: ${progress}%">
                            ${progress.toFixed(1)}%
                        </div>
                    </div>
                </div>
                <div class="goal-stats">
                    <span>Current: ₹${goal.currentAmount.toLocaleString()}</span>
                    <span>Target: ₹${goal.targetAmount.toLocaleString()}</span>
                    <span>Due: ${new Date(goal.targetDate).toLocaleDateString()}</span>
                </div>
                <div class="mt-3">
                    <button class="btn btn-sm btn-outline-primary" onclick="addToGoal(${goal.id})">Add Funds</button>
                    <button class="btn btn-sm btn-outline-secondary" onclick="editGoal(${goal.id})">Edit</button>
                    <button class="btn btn-sm btn-outline-danger" onclick="deleteGoal(${goal.id})">Delete</button>
                </div>
            </div>
        `;
    }).join('');

    // Update summary
    totalGoals.textContent = savingsGoals.length;
    totalTarget.textContent = `₹${totalTargetAmount.toLocaleString()}`;
    totalSaved.textContent = `₹${totalSavedAmount.toLocaleString()}`;
    const overallProgressPercent = (totalSavedAmount / totalTargetAmount) * 100;
    overallProgress.style.width = `${overallProgressPercent}%`;
    overallProgress.textContent = `${overallProgressPercent.toFixed(1)}%`;
}

document.getElementById('savingsGoalForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = {
        name: document.getElementById('goalName').value,
        targetAmount: parseFloat(document.getElementById('targetAmount').value),
        targetDate: document.getElementById('targetDate').value,
        initialAmount: parseFloat(document.getElementById('initialAmount').value) || 0,
        category: document.getElementById('goalCategory').value
    };

    // Add new goal
    const newGoal = {
        id: Date.now(),
        ...formData,
        currentAmount: formData.initialAmount
    };

    savingsGoals.push(newGoal);
    
    // Reset form
    this.reset();
    
    // Reload goals
    loadGoals();
    
    alert('Savings goal created successfully!');
});

function addToGoal(goalId) {
    const amount = prompt('Enter amount to add:');
    if (amount && !isNaN(amount) && amount > 0) {
        const goal = savingsGoals.find(g => g.id === goalId);
        if (goal) {
            goal.currentAmount += parseFloat(amount);
            loadGoals();
            alert(`Added ₹${amount} to ${goal.name}`);
        }
    }
}

function editGoal(goalId) {
    alert('Edit functionality will be implemented soon!');
}

function deleteGoal(goalId) {
    if (confirm('Are you sure you want to delete this goal?')) {
        savingsGoals = savingsGoals.filter(g => g.id !== goalId);
        loadGoals();
        alert('Goal deleted successfully!');
    }
}

function addToSavings() {
    alert('Quick add functionality will be implemented soon!');
}

function viewProgress() {
    alert('Detailed progress view will be implemented soon!');
}

function exportGoals() {
    const dataStr = JSON.stringify(savingsGoals, null, 2);
    const dataBlob = new Blob([dataStr], {type: 'application/json'});
    const url = URL.createObjectURL(dataBlob);
    const link = document.createElement('a');
    link.href = url;
    link.download = 'savings_goals.json';
    link.click();
    URL.revokeObjectURL(url);
    alert('Goals exported successfully!');
}

// Load goals on page load
document.addEventListener('DOMContentLoaded', loadGoals);
</script>
{% endblock %}ngsGoals.find(g => g.id === goalId);
        if (goal) {
            goal.currentAmount += parseFloat(amount);
            loadGoals();
            alert(`Added ₹${amount} to ${goal.name}`);
        }
    }
}

function editGoal(goalId) {
    alert('Edit functionality will be implemented soon!');
}

function deleteGoal(goalId) {
    if (confirm('Are you sure you want to delete this goal?')) {
        savingsGoals = savingsGoals.filter(g => g.id !== goalId);
        loadGoals();
        alert('Goal deleted successfully!');
    }
}

function addToSavings() {
    alert('Quick add functionality will be implemented soon!');
}

function viewProgress() {
    alert('Detailed progress view will be implemented soon!');
}

function exportGoals() {
    const dataStr = JSON.stringify(savingsGoals, null, 2);
    const dataBlob = new Blob([dataStr], {type: 'application/json'});
    const url = URL.createObjectURL(dataBlob);
    const link = document.createElement('a');
    link.href = url;
    link.download = 'savings_goals.json';
    link.click();
    URL.revokeObjectURL(url);
    alert('Goals exported successfully!');
}

// Load goals on page load
document.addEventListener('DOMContentLoaded', loadGoals);
</script>
{% endblock %}